package com.sample.download;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;

public class HttpDownloader {
	/**
	 * 根据URL下载文件，前提是这个文件当中的内容是文本，函数的返回值就是文件当中的内容
	 * 1.创建一个URL对象
	 * 2.通过URL对象，创建一个HttpURLConnetion对象
	 * 3.得到InputStream
	 * 4.从InputStream当中读取数据
	 * @param urlStr;
	 * @return
	 */
	public int download(String urlStr,String path,String fileName)	{
		InputStream inputStream=null;
		try{	
			FileUtils fileUtils=new FileUtils();
			if(fileUtils.isFileExist(path+fileName)){
				fileUtils.delSDFile(fileName);
			}			
			String reqFileStr = "feature";
			byte[] data = reqFileStr.getBytes();
			inputStream=getInputStreamFromUrl(urlStr,data);			
			File resultFile=fileUtils.write2SDFromInput(path, fileName, inputStream);
			if(resultFile==null){
				return -1;									
			}
		}catch(Exception e){
			e.printStackTrace();
		}finally{
			try{
				inputStream.close();
			}catch(Exception e){
				e.printStackTrace();
		}
	}
		return 1;
}
	public InputStream getInputStreamFromUrl(String urlStr, byte[] data) throws IOException{//
		URL url = new URL(urlStr);
		//创建一个Http连接
		HttpURLConnection urlConn=(HttpURLConnection)url.openConnection();
		urlConn.setRequestMethod("POST");
		urlConn.setRequestProperty("Content-Type", "text/xml");
		urlConn.setRequestProperty("Connection", "Keep-Alive");
		urlConn.setUseCaches( false);
		urlConn.setDoOutput(true);
		urlConn.setDoInput(true);
		OutputStream oStream=urlConn.getOutputStream();
		oStream.write(data);
		oStream.flush();
		oStream.close();
		InputStream iStream = urlConn.getInputStream();
		return iStream;
	}	
}
